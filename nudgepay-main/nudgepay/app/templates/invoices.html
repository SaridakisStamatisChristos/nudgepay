{% extends "base.html" %}{% block content %}
<h3>Invoices</h3>
<form method="post" action="/invoices" style="margin-bottom:1rem;">
  {{ csrf_input(request)|safe }}
  <input name="client_id" placeholder="Client ID" required>
  <input name="number" placeholder="INV-001" required>
  <input type="number" name="amount_cents" placeholder="e.g., 25000" required>
  <input type="date" name="due_date" required>
  <button>Create & Generate Pay Link</button>
</form>
<table role="grid">
  <thead><tr><th>ID</th><th>Number</th><th>Client</th><th>Due</th><th>Status</th><th>Link</th><th>Reminders</th><th>Actions</th></tr></thead>
  <tbody>
  {% for inv in invoices %}
    <tr>
      <td>{{inv.id}}</td>
      <td>{{inv.number}}</td>
      <td>{{inv.client_id}}</td>
      <td>{{inv.due_date}}</td>
      <td>{{inv.status}}</td>
      <td>{% if inv.stripe_payment_link %}<a href="{{inv.stripe_payment_link}}" target="_blank">Payment Link</a>{% else %}-{% endif %}</td>
      <td>{{ "On" if inv.reminders_enabled else "Off" }}</td>
      <td>
        {% if inv.status == "Open" %}
          <form hx-post="/invoices/{{inv.id}}/toggle-reminders" hx-swap="none" style="display:inline">
            {{ csrf_input(request)|safe }}
            <input type="hidden" name="version" value="{{ inv.version }}">
            <button type="submit">Toggle</button>
          </form>
          <form hx-post="/invoices/{{inv.id}}/send-nudge" hx-swap="none" style="display:inline">
            {{ csrf_input(request)|safe }}
            <input type="hidden" name="version" value="{{ inv.version }}">
            <button type="submit">Nudge</button>
          </form>
          <a href="/pay/{{inv.id}}" target="_blank">View</a>
        {% endif %}
      </td>
    </tr>
  {% endfor %}
  </tbody>
</table>
{% endblock %}
